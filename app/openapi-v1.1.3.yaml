openapi: 3.0.3
info:
  title: ShortOrg Backend API
  description: |
    ShortOrg Backend 서비스의 API 명세서입니다.
    로그인, 게시판, 모임, 쪽지, 신고, 평점 등의 기능을 제공합니다.
  version: 1.1.3

servers:
  - url: /api
    description: 기본 API 서버

tags:
  - name: Auth
    description: 로그인/로그아웃
  - name: User
    description: 회원/프로필
  - name: Post
    description: 게시글
  - name: Applicant
    description: 모임 신청/처리
  - name: Message
    description: 쪽지
  - name: Report
    description: 신고
  - name: Rating
    description: 평점

paths:
  /auth/login:
    post:
      summary: 로그인
      description: 입력한 ID와 PW로 로그인합니다.
      operationId: loginUser
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: 로그인 성공
        '400':
          description: 잘못된 요청 형식
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: 로그인 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/logout:
    get:
      summary: 로그아웃
      description: 로그아웃합니다.
      operationId: logout
      tags: [Auth]
      responses:
        '200':
          description: 로그아웃 성공

  /users:
    post:
      summary: 회원가입
      description: 신규 사용자를 등록합니다.
      operationId: signupUser
      tags: [User]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignupRequest'
      responses:
        "201":
          description: 회원가입 성공
        "400":
          description: 입력값 오류
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "409":
          description: 아이디 중복
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /users/exists:
    get:
      summary: 아이디 중복 체크
      description: 입력한 로그인 아이디의 중복 여부를 확인합니다.
      operationId: checkUserExists
      tags: [User]
      parameters:
        - name: loginId
          in: query
          required: true
          description: 중복 확인할 로그인 ID
          schema:
            type: string
            example: user123
      responses:
        "200":
          description: 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExistsResponse'
        "400":
          description: 요청 파라미터 누락
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /users/{userId}/profile:
    get:
      summary: 프로필 조회용 개인 정보
      description: 특정 사용자의 프로필(평점/모임횟수 등) 정보를 조회합니다.
      operationId: getUserProfile
      tags: [User]
      parameters:
        - name: userId
          in: path
          required: true
          description: 사용자 ID
          schema:
            type: string
            example: testuser
      responses:
        "200":
          description: 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfile'
        "404":
          description: 사용자를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /posts/category/{category}:
    get:
      summary: 주제별 게시글 리스트
      description: 입력한 주제의 게시글 리스트를 반환합니다.
      operationId: listPostsByCategory
      tags: [Post]
      parameters:
        - name: category
          in: path
          description: 한글로 된 게시글 주제 이름(운동, 오락, 식사, 자유)
          required: true
          schema:
            $ref: '#/components/schemas/PostCategory'
      responses:
        '200':
          description: 게시글 목록 반환 성공
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Post'

  /posts:
    post:
      summary: 게시글 작성
      description: 새 게시글(모임)을 작성합니다.
      operationId: createPost
      tags: [Post]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PostCreateRequest'
      responses:
        "201":
          description: 생성 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Post'
        "400":
          description: 입력값 오류
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /posts/id/{postId}:
    get:
      summary: 게시글 조회
      description: 게시글 ID로 단건 조회합니다.
      operationId: getPost
      tags: [Post]
      parameters:
        - name: postId
          in: path
          required: true
          description: 게시글 ID
          schema:
            type: integer
            example: 36
      responses:
        "200":
          description: 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Post'
        "404":
          description: 게시글을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      summary: 게시글 수정
      description: 게시글을 수정합니다.
      operationId: updatePost
      tags: [Post]
      parameters:
        - name: postId
          in: path
          required: true
          description: 게시글 ID
          schema:
            type: integer
            example: 36
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PostUpdateRequest'
      responses:
        "200":
          description: 수정 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Post'
        "400":
          description: 입력값 오류
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "403":
          description: 권한 없음(작성자 아님 등)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "404":
          description: 게시글을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      summary: 게시글 삭제
      description: 게시글을 삭제합니다.
      operationId: deletePost
      tags: [Post]
      parameters:
        - name: postId
          in: path
          required: true
          description: 게시글 ID
          schema:
            type: integer
            example: 36
      responses:
        "204":
          description: 삭제 성공(본문 없음)
        "403":
          description: 권한 없음(작성자 아님 등)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "404":
          description: 게시글을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /posts/nearby:
    get:
      summary: 위치 기반 게시글 목록
      description: 현재 위치 기준으로 근처 게시글 목록을 조회합니다.
      operationId: listPostsNearby
      tags: [Post]
      parameters:
        - name: latitude
          in: query
          required: true
          description: 현재 위치 위도
          schema:
            type: number
            example: 37.504296
        - name: longitude
          in: query
          required: true
          description: 현재 위치 경도
          schema:
            type: number
            example: 127.004794
        - name: radiusMeters
          in: query
          required: false
          description: 반경(미터). 미지정 시 서버 기본값 사용
          schema:
            type: integer
            example: 1000
        - name: category
          in: query
          required: false
          description: 주제 필터(선택)
          schema:
            $ref: '#/components/schemas/PostCategory'
      responses:
        "200":
          description: 조회 성공
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Post'
        "400":
          description: 요청 파라미터 오류
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /messages:
    post:
      summary: 쪽지 보내기
      description: 특정 사용자에게 쪽지를 전송합니다.
      operationId: sendMessage
      tags: [Message]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MessageSendRequest'
      responses:
        "201":
          description: 전송 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Message'
        "400":
          description: 입력값 오류
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "404":
          description: 수신자/게시글을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /posts/{postId}/applicants:
    post:
      summary: 모임 신청
      description: 해당 게시글(모임)에 참가 신청을 보냅니다.
      operationId: applyToPost
      tags: [Applicant]
      parameters:
        - name: postId
          in: path
          required: true
          description: 게시글 ID
          schema:
            type: integer
            example: 46
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApplicantApplyRequest'
      responses:
        "201":
          description: 신청 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Applicant'
        "400":
          description: 신청 불가(이미 신청/정원 초과/상태 오류 등)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "404":
          description: 게시글을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      summary: 모임 신청 목록
      description: 특정 게시글의 신청자 목록을 조회합니다.
      operationId: listApplicants
      tags: [Applicant]
      parameters:
        - name: postId
          in: path
          required: true
          description: 게시글 ID
          schema:
            type: integer
            example: 46
      responses:
        "200":
          description: 조회 성공
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Applicant'
        "403":
          description: 권한 없음(모집자만 조회 가능)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "404":
          description: 게시글을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /posts/{postId}/applicants/{userId}:
    patch:
      summary: 모임 신청 처리(수락/거절)
      description: 특정 신청자의 신청 상태를 수락 또는 거절로 변경합니다.
      operationId: decideApplicant
      tags: [Applicant]
      parameters:
        - name: postId
          in: path
          required: true
          description: 게시글 ID
          schema:
            type: integer
            example: 46
        - name: userId
          in: path
          required: true
          description: 신청자 ID
          schema:
            type: string
            example: testuser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApplicantDecisionRequest'
      responses:
        "200":
          description: 처리 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Applicant'
        "400":
          description: 처리 불가(이미 처리됨)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "403":
          description: 권한 없음(모집자만 처리 가능)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "404":
          description: 신청 정보를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /reports:
    post:
      summary: 신고하기
      description: 사용자/게시글을 신고합니다.
      operationId: createReport
      tags: [Report]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReportCreateRequest'
      responses:
        "201":
          description: 신고 접수 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Report'
        "400":
          description: 입력값 오류
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "404":
          description: 대상(유저/게시글)을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /posts/{postId}/ratings:
    post:
      summary: 모임원 평점 매기기
      description: 특정 모임(게시글)에 참여한 구성원에게 평점을 남깁니다.
      operationId: rateMember
      tags: [Rating]
      parameters:
        - name: postId
          in: path
          required: true
          description: 게시글 ID
          schema:
            type: integer
            example: 46
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RatingRequest'
      responses:
        "201":
          description: 평점 등록 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Rating'
        "400":
          description: 평점 등록 불가(자기 자신/중복 평가/모임 종료 전 등)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "403":
          description: 권한 없음(참여자가 아님 등)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "404":
          description: 게시글/대상 사용자를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    ErrorResponse:
      description: 공통 에러 응답
      type: object
      properties:
        code:
          type: string
          example: INVALID_REQUEST
        message:
          type: string
          example: 요청 파라미터가 올바르지 않습니다.
      required: [code, message]

    LoginRequest:
      description: 로그인 요청
      type: object
      properties:
        id:
          type: string
          description: 사용자 ID
          example: "testuser"
        password:
          type: string
          description: 사용자 비밀번호
          example: "testpw"
      required: [id, password]

    SignupRequest:
      description: 회원가입 요청
      type: object
      required: [id, password]
      properties:
        id:
          type: string
          example: user123
        password:
          type: string
          example: 1234

    ExistsResponse:
      description: 아이디 존재 여부
      type: object
      properties:
        exists:
          type: boolean
          example: true
      required: [exists]

    UserProfile:
      description: 프로필 조회용 개인 정보
      type: object
      properties:
        id:
          type: string
          description: 사용자 ID
          example: testuser
        avgRate:
          type: number
          description: 평균 평점
          example: 4.6
        orgTime:
          type: integer
          description: 진행한 모임 횟수(모집자/참가자 포함)
          example: 12
      required: [id, avgRate, orgTime]

    PostCategory:
      description: 게시글 주제
      type: string
      enum: [운동, 오락, 식사, 자유]

    Post:
      description: 게시글
      type: object
      properties:
        id:
          type: integer
          description: 게시글 ID
          example: 36
        category:
          $ref: '#/components/schemas/PostCategory'
        title:
          type: string
          description: 게시글 제목
          example: '제목입니다'
        content:
          type: string
          description: 게시글 내용
          example: '내용입니다'
        meetingTime:
          type: string
          format: date-time
          description: 모임 시간
          example: "2026-01-13T14:30:00"
        longitude:
          type: number
          description: 모임위치(경도)
          example: 127.004794
        latitude:
          type: number
          description: 모임위치(위도)
          example: 37.504296
        state:
          type: string
          description: 모임 상태(모집중, 시작됨, 종료됨)
          enum: [OPEN, STARTED, ENDED]
        joinMode:
          type: string
          enum: [INSTANT, APPROVAL]
          description: 모집 구분(허가 필요없는 선착순/허가제)
        lastModified:
          type: string
          format: date-time
          description: 게시글의 최종 수정 시간
          example: "2026-01-13T14:30:00"
      required:
        - id
        - category
        - title
        - content
        - meetingTime
        - longitude
        - latitude
        - state
        - joinMode
        - lastModified

    PostCreateRequest:
      description: 게시글 작성 요청(로그인 후에만 사용 가능)
      type: object
      required: [category, title, content, meetingTime, longitude, latitude, joinMode]
      properties:
        userId:
          type: string
          description: 작성자 id
          example: 'user01'
        category:
          $ref: '#/components/schemas/PostCategory'
        title:
          type: string
          example: '같이 운동하실 분!'
        content:
          type: string
          example: '저녁 7시에 러닝하실 분 구해요.'
        meetingTime:
          type: string
          format: date-time
          example: "2026-01-13T19:00:00"
        longitude:
          type: number
          example: 127.004794
        latitude:
          type: number
          example: 37.504296
        joinMode:
          type: string
          enum: [INSTANT, APPROVAL]
          example: APPROVAL

    PostUpdateRequest:
      description: 게시글 수정 요청
      type: object
      properties:
        category:
          $ref: '#/components/schemas/PostCategory'
        title:
          type: string
          example: '제목 수정'
        content:
          type: string
          example: '내용 수정'
        meetingTime:
          type: string
          format: date-time
          example: "2026-01-13T20:00:00"
        longitude:
          type: number
          example: 127.004794
        latitude:
          type: number
          example: 37.504296
        state:
          type: string
          enum: [OPEN, STARTED, ENDED]
        joinMode:
          type: string
          enum: [INSTANT, APPROVAL]

    Message:
      description: 쪽지
      type: object
      properties:
        id:
          type: integer
          example: 1001
        postId:
          type: integer
          example: 46
        senderId:
          type: string
          example: testuser
        receiverId:
          type: string
          example: otherUser
        content:
          type: string
          example: '모임 관련 문의드립니다!'
      required: [id, postId, senderId, receiverId, content]
      
    MessageSendRequest:
      description: 쪽지 전송 요청
      type: object
      required: [postId, receiverId, content]
      properties:
        postId:
          type: integer
          description: 관련 게시글 ID
          example: 46
        receiverId:
          type: string
          description: 수신자 ID
          example: otherUser
        content:
          type: string
          description: 쪽지 내용
          example: '모임 관련 문의드립니다!'

    Applicant:
      description: 모임 참가 신청 상태
      type: object
      properties:
        postId:
          type: integer
          description: 모임 게시글 id
          example: 46
        userId:
          type: string
          description: 신청자 id
          example: 'testuser'
        state:
          type: string
          enum: [APPROVED, REJECTED, PENDING]
          description: 신청 처리 상태(수락/거절/대기중)
      required: [postId, userId, state]

    ApplicantApplyRequest:
      description: 모임 신청 요청(확장 대비). 현재는 비워도 됨.
      type: object
      properties:
        message:
          type: string
          description: 신청 메시지(선택)
          example: '참가하고 싶어요!'

    ApplicantDecisionRequest:
      description: 모임 신청 처리 요청
      type: object
      required: [state]
      properties:
        state:
          type: string
          enum: [APPROVED, REJECTED]
          example: APPROVED

    ReportCreateRequest:
      description: 신고 생성 요청
      type: object
      required: [targetUserId, postId, description]
      properties:
        targetUserId:
          type: string
          description: 신고 대상 사용자 ID
          example: badUser
        postId:
          type: integer
          description: 관련 게시글 ID
          example: 46
        description:
          type: string
          description: 신고 사유/설명
          example: '욕설 및 불쾌한 발언'

    Report:
      description: 신고
      type: object
      properties:
        id:
          type: integer
          example: 501
        reporterId:
          type: string
          example: testuser
        targetId:
          type: string
          example: badUser
        postId:
          type: integer
          example: 46
        description:
          type: string
          example: '욕설 및 불쾌한 발언'
        createdAt:
          type: string
          format: date-time
          example: "2026-01-13T14:30:00"
      required: [id, reporterId, targetId, postId, description, createdAt]

    RatingRequest:
      description: 평점 등록 요청
      type: object
      required: [targetUserId, score]
      properties:
        targetUserId:
          type: string
          description: 평점 대상 사용자 ID
          example: otherUser
        score:
          type: integer
          description: 평점(1~5)
          minimum: 1
          maximum: 5
          example: 5
        comment:
          type: string
          description: 한줄평(선택)
          example: '시간 약속을 잘 지켜요!'

    Rating:
      description: 평점
      type: object
      properties:
        id:
          type: integer
          example: 9001
        postId:
          type: integer
          example: 46
        raterId:
          type: string
          example: testuser
        targetUserId:
          type: string
          example: otherUser
        score:
          type: integer
          example: 5
        comment:
          type: string
          example: '시간 약속을 잘 지켜요!'
        createdAt:
          type: string
          format: date-time
          example: "2026-01-13T21:10:00"
      required: [id, postId, raterId, targetUserId, score, createdAt]
